$(function(){
	var $username = $('#register-username'),
		$password = $('#register-password'),
		$passwordcheck = $('#register-checkpwd');
	$('.SlectBox').SumoSelect({
		floatWidth: 500,
		forceCustomRendering: true,
		search: true
	});
	// 点击的时候获取表单下拉框的数据的方法
	/*$('.form-opera').on('click', function(e){
		var select = $('#register-life-love option:selected');
		select.each(function(item, index){
			console.log(item);
			console.log(index);
		})
		e.preventDefault();
	});*/

	//表单验证 
	$('#register-form').validate({
		rules:{
			username: {
				required: true,
				rangelength: [6, 30]
			},
			pwd: {
				required: true,
				rangelength: [6, 16]
			},
			pwd2: {
				required: true,
				rangelength: [6, 16],
				equalTo: "#register-password"
			}
		},
		messages: {
			username: {
				required: "请输入用户名",
				rangelength: "用户名为6-30位"
			},
			pwd: {
				required: "请输入密码",
				rangelength: "密码长度为6-16位"
			},
			pwd2: {
				required: "请确认密码",
				rangelength: "密码长度为6-16位",
				equalTo: "两次输入的密码不一致"
			}
		},
		focusInvalid: true,
		errorClass: 'loginError',
		validClass: 'loginPass',
		errorElement: 'i',
		errorContainer: true
	});
	(function(){
		$('#register-form').valid();
	})();
	// 提交表单
	$('#form-submit').bind('click', function(event) {
		if ($('#register-form').valid()) {
			var username = $username.val(),
				url = "CheckUserLogging?username=" + username;
			$.ajax({
				type: "POST",
				url: url,
				dataType: "text",
				success: function(data) {
					if ( data === "1" ) {
						$('#register-form').submit();
					} else if ( data === "2" ) {
						$username.removeClass("loginPass").addClass("loginError").siblings("i").text("用户名已经被注册").css("display","inline");
					}
				}
			});
		}
		return false;
	});

	// 用户名失去焦点时验证用户名可用性
	$username.on('blur', function(){
		var username = $(this).val(),
			url = "CheckUserLogging?username=" + username;
		
		if( $("#register-form").validate().element(this) ) {
			$.ajax({
				type: "POST",
				url: url,
				dataType: "text",
				success: function(data) {
					if ( data === "2" ) {
						$username.removeClass("loginPass").addClass("loginError").siblings("i").text("用户名已经被注册").css("display","inline");
					}
				}
			});
		}
	});

	$password.on('blur', function(){
		$("#register-form").validate().element(this);
	});
	$passwordcheck.on('blur', function(){
		$("#register-form").validate().element(this);
	});
});